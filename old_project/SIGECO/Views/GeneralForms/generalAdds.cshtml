@model IEnumerable<TableColumns>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="content">
    <div class="row">
        <div class="col-lg-12">
            <!-- general form elements -->
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">@ViewBag.FormTitle</h3>
                </div>
                <!-- /.box-header -->
                <!-- form start -->
                <form id="frmGeneral" role="form" action="@Url.Action("Save", "General")" method="post">
                    <div class="box-body">
                        <div class="form-group">
                            <input type="hidden" id="tblSchema" name="tblSchema" value="@ViewBag.tblSchema" />
                            <input type="hidden" id="tblName" name="tblName" value="@ViewBag.tblName" />
                        </div>
                        @foreach (var i in Model)
                        {
                            <div class="form-group">
                                @if (i.HTML_ADD_SHOW == true)
                                {
                                    <label for="@i.COLUMN_NAME">@i.CAPTION</label>
                                    if (i.NULLABLE == true)
                                    {
                                        if (i.DATA_TYPE.Equals("numeric"))
                                        {
                                            <input name="@i.COLUMN_NAME" type="@i.HTML_TYPE" class="form-control" id="@i.COLUMN_NAME" placeholder="Escriba el valor de @i.CAPTION ..." maxlength="@i.MAX_LENGTH" step=".01" lang="en-us" pattern="@i.HTML_PATTERN" disabled="@i.HTML_ADD_LOCK">
                                        }
                                        else
                                        {
                                            <input name="@i.COLUMN_NAME" type="@i.HTML_TYPE" class="form-control" id="@i.COLUMN_NAME" placeholder="Escriba el valor de @i.CAPTION ..." maxlength="@i.MAX_LENGTH" pattern="@i.HTML_PATTERN" disabled="@i.HTML_ADD_LOCK">
                                        }
                                    }
                                    else
                                    {
                                        if (i.IS_FK == null || i.IS_FK.Equals("false"))
                                        {
                                            if (i.DATA_TYPE.Equals("numeric"))
                                            {
                                                <input name="@i.COLUMN_NAME" type="@i.HTML_TYPE" class="form-control" id="@i.COLUMN_NAME" placeholder="Escriba el valor de @i.CAPTION ..." maxlength="@i.MAX_LENGTH" step=".01" lang="en-us" pattern="@i.HTML_PATTERN" required disabled="@i.HTML_ADD_LOCK">
                                            }
                                            else
                                            {
                                                <input name="@i.COLUMN_NAME" type="@i.HTML_TYPE" class="form-control" id="@i.COLUMN_NAME" placeholder="Escriba el valor de @i.CAPTION ..." maxlength="@i.MAX_LENGTH" pattern="@i.HTML_PATTERN" required disabled="@i.HTML_ADD_LOCK">
                                            }
                                        }
                                        else
                                        {
                                            <select name="@i.COLUMN_NAME" id="@i.COLUMN_NAME" data-formName="@i.TABLE_NAME" class="select" disabled="@i.HTML_ADD_LOCK" style="width: 100%; height: 34px;" required>
                                                <option value="1">
                                                    Opción 1
                                                </option>
                                            </select>
                                        }
                                    }
                                }
                            </div>
                        }
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer">
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>


@section Scripts {

    <script>

        $(document).ready(function () {

            var x = document.getElementsByClassName("select");

            for (i = 0; i < x.length; i++) {
                var value = x[i].getAttribute('data-formName');
                fnCargarCombos(x[i].id, value);
            }

            $("#frmGeneral").submit(function (e) {
                e.preventDefault();
                var formulario = document.getElementById("frmGeneral");
                var jsonData = JSON.stringify($("#frmGeneral").serializeArray());
                console.log(jsonData);

                var request = $.ajax({
                    url: "@Url.Action("Save", "General")",
                    method: "POST",
                    data: { jsonValores: jsonData },
                    dataType: "json"
                });
                request.done(function (msg) {
                    alert(msg);
                });
                request.fail(function (jqXHR, textStatus) {
                    alert("Petición fallida: " + textStatus);
                });

                //formulario.submit();
            });

        });


        function fnCargarCombos(var_id, var_formName) {
            var request = $.ajax({
                url: "@Url.Action("GetComboList", "General")",
                method: "POST",
                data: { sSelectName: var_id, sFormName: var_formName },
                dataType: "json"
            });
            request.done(function (msg) {

                $('#' + var_id).html("");

                for (i = 0; i < msg.length; i++) {
                    $('#' + var_id).append('<option value="' + msg[i].nValorCatalogoID + '">' + msg[i].sDescripcion + '</option>');
                }

                //$('#' + var_id).append('<option value="' + "-1" + '">' + "Todos" + '</option>');

                if ($('#' + var_id + " option").length > 0) {
                    $('#' + var_id).val($('#' + var_id + " option")[0].value).trigger("change");
                }
            });
            request.fail(function (jqXHR, textStatus) {
                alert("Petición fallida: " + textStatus);
            });
        }

        //fnCargarEstadoCierre(0);

    </script>

}






