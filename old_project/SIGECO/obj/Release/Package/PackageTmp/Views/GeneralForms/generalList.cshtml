@model IEnumerable<TableColumns>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="content">
    <div class="row">
        <div class="col-lg-12">
            <!-- general form elements -->
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">@ViewBag.FormTitle</h3>
                </div>
                <!-- /.box-header -->
                <!-- Table Start -->
                <div class="row">
                    <div class="col-lg-12">

                        <div class="form-group">
                            <input type="hidden" id="tblSchema" name="tblSchema" value="@ViewBag.tblSchema" />
                            <input type="hidden" id="tblName" name="tblName" value="@ViewBag.tblName" />
                        </div>

                        <div class="table-responsive">
                            <table id="tblGeneral" class="table table-striped table-bordered table-hover dataTables-example">
                                <thead>
                                    <tr>
                                        <th></th>
                                        @foreach (var i in Model)
                                        {
                                            <th>@i.CAPTION</th>
                                        }
                                    </tr>
                                </thead>
                                <tbody id="tblBody"></tbody>
                                <tfoot>
                                </tfoot>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Styles {

    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/plugins/dataTables/")datatables.min.css">
    
}

@section Scripts {
    <script src="@Url.Content("~/Scripts/plugins/dataTables/")dataTables.min.js"></script>

    <script>
        $(document).ready(function () {

            var tblshema = $('#tblSchema').val();
            var tblname = $('#tblName').val();
            var tblbody = $('#tblBody');

            var request = $.ajax({
                async: false,
                url: "@Url.Action("ListData", "General")",
                method: "POST",
                data: { schema: tblshema, table: tblname },
                dataType: "json"
            });
            request.done(function (msg) {

                var parsed = JSON.parse(msg);
                var strAppend = '';

                $.each(parsed.root.row, function (key, value) {
                    strAppend += '<tr>';
                    strAppend += '\
                        <td> \
                            <button class="btn btn-warning btn-sm btn-circle" type="button" title="Ver Contactos" onclick=""> \
                                <i class="fas fa-pencil-alt"></i> \
                            </button> \
                            <button class="btn btn-danger btn-sm btn-circle" type="button" title="Ver Contactos" onclick=""> \
                                <i class="fas fa-times"></i> \
                            </button> \
                        </td> \
                    ';

                    $.each(value, function (key2, value2) {
                        strAppend += '<td>';
                        strAppend += value2;
                        strAppend += '</td>';
                    });
                    strAppend += '</tr>';
                });

                tblbody.append(strAppend);

            });
            request.fail(function (jqXHR, textStatus) {
                alert("Petición fallida: " + textStatus);
            });


            //DataTable
            $('#tblGeneral thead th').each(function (i) {
                var title = $('#tblGeneral thead th').eq($(this).index()).text();
                if (i != 0)
                    $(this).append('<input type="text" style="width: 100%" data-index="' + i + '" />');
                else
                    $(this).append('<input type="text" style="width: 100%" data-index="' + i + '" disabled />');
            });

            var table = $('#tblGeneral').DataTable({
                bSort: false,
                scrollY: 400,
                scrollX: true,
                "language": {
                    "url": "@Url.Content("~/Content/Jsons/")dataTablesSpanish.json"
                },
                pageLength: 25,
                responsive: true,
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                { extend: 'copy', text: 'Copiar' },
                { extend: 'csv', text: 'CSV', title: 'Carreras' },
                { extend: 'excel', text: 'XLS', title: 'Carreras' },
                { extend: 'pdf', text: 'PDF', title: 'Carreras' },

                {
                    extend: 'print',
                    customize: function (win) {
                        $(win.document.body).addClass('white-bg');
                        $(win.document.body).css('font-size', '10px');

                        $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                    }
                }
                ],

                "columnDefs": [{
                    "defaultContent": "-",
                    "targets": "_all"
                }],

                "initComplete": function (settings, json) {

                }
            });

            table.columns().eq(0).each(function (colIdx) {
                $('input', table.column(colIdx).header()).on('keyup change', function () {
                    //regExSearch = '^\\s' + this.value + '||TOTAL*' + '\\s*$';
                    if (colIdx != 0)
                        table.column(colIdx).search(this.value).draw();
                    else {
                        //regexs = "^(" + this.value + "|(TOTAL " + this.value + "))$";
                        table.column(colIdx).search(this.value, true, false).draw();
                    }
                });
            });





        });


    </script>

}






